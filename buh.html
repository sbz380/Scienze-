<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Fantacalcolo - Formazione e Media Voti</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
table, th, td { border: 1px solid black; border-collapse: collapse; padding: 6px; }
th { background: #e6e6e6; }
select { width: 100%; }
</style>
</head>
<body>

<h2>Incolla i dati dei giocatori:</h2>
<textarea id="raw" rows="15" cols="80"></textarea><br><br>
<button onclick="process()">Elabora</button>

<h2>Tabella Giocatori e Medie</h2>
<table id="playersTable"></table>

<h2>Schiera la Formazione (11 giocatori)</h2>
<div id="formation"></div>
<p><strong>Voto Totale Stimato:</strong> <span id="totalScore">0</span></p>

<script>

function parseRawText(raw){
  const lines = raw.split(/\r?\n/).map(l=>l.trim());
  const players = [];
  let i = 0;

  while(i < lines.length){
    let line = lines[i];

    // Se Ã¨ un nome (almeno una lettera)
    if(/[A-Za-z\u00C0-\u017F]/.test(line)){
      let name = line;
      let scores = [];
      let j = i + 1;

      // raccoglie fino a riempire 10 valori numerici
      while(j < lines.length && scores.length < 10){
        const tokens = lines[j].split(/\s+/);

        tokens.forEach(t => {
          let tok = t.replace(/,/g,'.').trim();
          let val = parseFloat(tok);
          if(!isNaN(val)) scores.push(val); // conta solo numeri
        });
        j++;
      }

      players.push({name, scores});
      i = j;
    } else {
      i++;
    }
  }
  return players;
}

function avg(arr){
  const nums = arr.filter(v => !isNaN(v));
  return nums.length ? (nums.reduce((a,b)=>a+b,0)/nums.length).toFixed(2) : "-";
}

function process(){
  const raw = document.getElementById("raw").value;
  const players = parseRawText(raw);

  // Mostra tabella giocatori
  const tbl = document.getElementById("playersTable");
  tbl.innerHTML = "<tr><th>Giocatore</th><th>Media</th></tr>";
  players.forEach(p=>{
    tbl.innerHTML += `<tr><td>${p.name}</td><td>${avg(p.scores)}</td></tr>`;
  });

  // Selezionabili solo giocatori con almeno 1 voto valido
  const selectable = players.filter(p => p.scores.some(v => !isNaN(v)));

  // Formazione (11 slot)
  const formation = document.getElementById("formation");
  formation.innerHTML = "";
  for(let i=0;i<11;i++){
    let s = "<select class='slot' onchange='updateTotal()'>";
    s += "<option value=''>-- Scegli giocatore --</option>";
    selectable.forEach(p=>{
      s += `<option value="${avg(p.scores)}">${p.name} (${avg(p.scores)})</option>`;
    });
    s += "</select><br>";
    formation.innerHTML += s;
  }
}

function updateTotal(){
  const scores = [...document.querySelectorAll('.slot')]
    .map(s=>parseFloat(s.value))
    .filter(v=>!isNaN(v));

  const total = scores.reduce((a,b)=>a+b,0).toFixed(2);
  document.getElementById("totalScore").innerText = total;
}

</script>
</body>
</html>